(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[640],{1786:function(e,t,s){Promise.resolve().then(s.bind(s,8720))},8720:function(e,t,s){"use strict";s.r(t);var a=s(7437),l=s(6230),i=s(1505),n=s(5689),c=s(4628),r=s(7664),o=s(7907),d=s(2265),m=s(828);t.default=e=>{let{params:t}=e,s=(0,o.useRouter)(),x=(0,m.I0)(),[u,h]=(0,d.useState)(0),p=(0,m.v9)(e=>e.ComboToki.comboSlected),[f,j]=(0,d.useState)(""),[b,N]=(0,d.useState)(!1);(0,d.useEffect)(()=>{h(p.reduce((e,t)=>e+t.quantity*t.price,0))},[p]);let v=t.ticket;(0,d.useEffect)(()=>{x((0,r.Ut)(v))},[x]);let y=(0,m.v9)(e=>{var t;return null===(t=e.auth)||void 0===t?void 0:t.userId}),g=(0,m.v9)(e=>e.ticket.holdTicket),w=g.price+u,k=(0,m.v9)(e=>e.Payment.paymentUrl),_=(0,m.v9)(e=>e.Payment.paymentStatus),P=(0,m.v9)(e=>e.Payment.paymentId),I=(0,m.v9)(e=>e.ticket.ticket);(0,d.useEffect)(()=>{k&&window.open(k,"_blank","width=1100,height=700")},[k,P]),(0,d.useEffect)(()=>{"succeeded"===_&&T()},[_]),(0,d.useEffect)(()=>{let e=setInterval(()=>{"waiting"===_?(N(!0),x((0,c.JV)({vnp_TxnRef:P}))):"succeeded"===_&&(clearInterval(e),N(!1))},3e3);return()=>clearInterval(e)},[x,_,P]);let T=()=>{if(""!=f&&("VNPAY"!=f||P||x((0,c.Ji)({user_id:y,amount:g.price+u,bankCode:"NCB",language:"vn"})),"succeeded"===_)){let e=g.seat_id.map(e=>e._id);x((0,r.HM)({seat_id:e,user_id:g.user_id,show_timeId:g.show_timeId._id,show_timeIndex:g.show_timeIndex,price:w,combos:g.combos,payment:f})),x((0,r.XZ)(v))}},C=()=>{x((0,r.XZ)(v)),s.push("/")},E=new Date;E.setMinutes(E.getMinutes()+15);let S=()=>{let e=new Date().getTime();return E.getTime()-e},[Z,B]=(0,d.useState)(S());return(0,d.useEffect)(()=>{let e=setInterval(()=>{B(S())},1e3);return()=>clearInterval(e)},[]),(0,d.useEffect)(()=>{Z<=0&&C()},[Z,C]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"container mx-auto my-10",children:[(0,a.jsx)(l.tB,{isLoading:b}),(0,a.jsx)(n.Z,{isOpen:"succeeded"===_,ticket:I}),(0,a.jsx)("div",{className:"backdrop-blur-md bg-gray-100/10 p-4 w-full rounded-2xl flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center mx-2",children:[(0,a.jsx)("p",{className:"font-bold text-indigo-300 text-[30px]",children:"P"}),(0,a.jsx)("p",{className:"font-bold text-pink-300 text-[30px]",children:"a"}),(0,a.jsx)("p",{className:"font-bold text-pink-400 text-[30px]",children:"y"}),(0,a.jsx)("p",{className:"font-bold text-amber-500 text-[30px]",children:"m"}),(0,a.jsx)("p",{className:"font-bold text-amber-400 text-[30px]",children:"e"}),(0,a.jsx)("p",{className:"font-bold text-amber-200 text-[30px]",children:"n"}),(0,a.jsx)("p",{className:"font-bold text-orange-600 text-[30px]",children:"t"})]})}),(0,a.jsx)("div",{className:"my-2 backdrop-blur-0 mx-auto bg-gray-100/10 rounded-xl p-4 w-[20%]",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,a.jsx)("p",{className:"text-md font-bold",children:"Thời gian thanh to\xe1n"}),(0,a.jsx)("span",{children:(e=>{let t=Math.floor(e%6e4/1e3);return"".concat(Math.floor(e/6e4),":").concat(t<10?"0":"").concat(t)})(Z)})]})}),(0,a.jsx)("div",{className:"my-5",children:(0,a.jsx)(l.F6,{onChange:e=>{j(e)}})}),(0,a.jsx)("div",{className:"my-5",children:(0,a.jsx)(i.Z,{props:{heldTicket:g,totalPriceCombos:u,totalTicketPrice:w,successBookingTicket:T}})})]})})}},1505:function(e,t,s){"use strict";var a=s(7437),l=s(7628),i=s(9195),n=s(828),c=s(2265),r=s(7664),o=s(7907);t.Z=e=>{let{props:t}=e,s=(0,o.useRouter)(),d=t.heldTicket,m=(0,n.I0)(),[x,u]=(0,c.useState)(0),h=(0,n.v9)(e=>e.ComboToki.comboSlected);(0,c.useEffect)(()=>{u(h.reduce((e,t)=>e+t.quantity*t.price,0))},[h]);let p=d.price+x;if(0==d.length)return(0,a.jsx)(i.Z,{});let{cinema_id:f,movie_id:j,show_times:b,room_id:N}=d.show_timeId,v={combos:h};return(0,a.jsx)(a.Fragment,{children:0===d.length?(0,a.jsx)("p",{children:"Loading..."}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"min-h-[200px] h-fit my-5 backdrop-blur-md bg-gray-100/10 rounded-2xl p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-8 gap-4 p-2",children:[(0,a.jsxs)("div",{className:"col-span-2 flex items-start ",children:[(0,a.jsx)("img",{src:j.thumnail,alt:j.title,className:"w-[120px] h-[180px] rounded-xl"}),(0,a.jsxs)("div",{className:"mx-4",children:[(0,a.jsx)("h2",{className:"my-2",children:j.title}),(0,a.jsx)("p",{className:"text-sm my-2",children:j.rated})]})]}),(0,a.jsxs)("div",{className:"col-span-3 ",children:[(0,a.jsxs)("div",{className:"flex items-start justify-start my-2",children:[(0,a.jsx)("p",{className:"font-bold w-[20%]",children:"Rạp "}),(0,a.jsx)("span",{className:" ",children:f.name})]}),(0,a.jsxs)("div",{className:"flex items-start justify-start my-2",children:[(0,a.jsx)("p",{className:"font-bold w-[20%]",children:"Suất chiếu "}),(0,a.jsx)("p",{className:"",children:b[Number(d.show_timeIndex)]})]}),(0,a.jsxs)("div",{className:"flex items-start justify-start my-2",children:[(0,a.jsx)("p",{className:"font-bold w-[20%]",children:"Ph\xf2ng chiếu "}),(0,a.jsx)("p",{className:"",children:N.room_name})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-start my-2",children:[(0,a.jsx)("p",{className:"font-bold w-[20%]",children:"Ghế"}),d.seat_id.map((e,t)=>(0,a.jsx)("p",{className:"mx-2",children:e.name},t))]})]}),(0,a.jsxs)("div",{className:"col-span-2 ",children:[(0,a.jsxs)("div",{className:"flex items-start justify-start my-2 ",children:[(0,a.jsx)("p",{className:"font-bold w-[30%]",children:"Gi\xe1 v\xe9"}),(0,a.jsx)("span",{className:" ",children:(0,l.xP)(d.price)})]}),(0,a.jsxs)("div",{className:"flex items-start justify-start my-2",children:[(0,a.jsx)("p",{className:"font-bold w-[30%]",children:"Combo"}),(0,a.jsx)("span",{className:" ",children:t.totalPriceCombos?(0,l.xP)(t.totalPriceCombos):(0,l.xP)(x)})]}),(0,a.jsxs)("div",{className:"flex items-start justify-start my-2",children:[(0,a.jsx)("p",{className:"font-bold w-[30%]",children:"Tổng tiền"}),(0,a.jsx)("span",{className:"",children:t.totalTicketPrice?(0,l.xP)(t.totalTicketPrice):(0,l.xP)(p)})]})]}),(0,a.jsx)("div",{className:"col-span-1 flex items-center justify-center my-2",children:(0,a.jsxs)("div",{onClick:()=>{if(t.successBookingTicket)return t.successBookingTicket();m((0,r.eB)({id:d._id,data:v})),s.push("/booking/payment/".concat(d._id,"/infopayment"))},className:"relative cursor-pointer inline-flex items-center justify-center px-6 py-3 overflow-hidden font-bold text-white rounded-md shadow-2xl group",children:[(0,a.jsx)("span",{className:"absolute inset-0 w-full h-full transition duration-300 ease-out opacity-0 bg-gradient-to-br from-pink-600 via-purple-700 to-blue-400 group-hover:opacity-100"}),(0,a.jsx)("span",{className:"absolute top-0 left-0 w-full bg-gradient-to-b from-white to-transparent opacity-5 h-1/3"}),(0,a.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-1/3 bg-gradient-to-t from-white to-transparent opacity-5"}),(0,a.jsx)("span",{className:"absolute bottom-0 left-0 w-4 h-full bg-gradient-to-r from-white to-transparent opacity-5"}),(0,a.jsx)("span",{className:"absolute bottom-0 right-0 w-4 h-full bg-gradient-to-l from-white to-transparent opacity-5"}),(0,a.jsx)("span",{className:"absolute inset-0 w-full h-full border border-white rounded-md opacity-10"}),(0,a.jsx)("span",{className:"absolute w-0 h-0 transition-all duration-300 ease-out bg-white rounded-full group-hover:w-56 group-hover:h-56 opacity-5"}),(0,a.jsx)("span",{className:"relative",children:"Đặt V\xe9"})]})})]})})})})}}},function(e){e.O(0,[921,425,230,971,69,744],function(){return e(e.s=1786)}),_N_E=e.O()}]);